*操作系统如何决定从内存中踢出哪一页（或哪几页）？这个决定由系统的替换策略做出，替换策略通常会遵循一些通用的原则（下面将会讨论），但也会包括一些调整，以避免特殊情况下的行为。*

### 缓存管理

*由于内存只包含系统中所有页的子集，因此可以将其视为系统中虚拟内存页的缓存（cache）。*

*可以将目标看成让缓存命中（cache hit）最多，即在内存中找到待访问页的次数最多。*

*知道了缓存命中和未命中的次数， 就可以计算程序的平均内存访问时间（Average Memory Access Time，AMAT，计算机架构师衡量硬件缓存的指标）。*

$AMAT = (P_{Hit} \cdot T_M) + (P_{Miss} \cdot T_D)$

- $T_M$ 表示访问内存的成本
- $T_D$ 表示访问磁盘的成本
- $P_Hit$ 表示在缓存中找到数据的概率（命中）
- $P_Miss$ 表示在缓存中找不到数据的概率（未命中）
- $P_Hit$ 和 $P_Miss$ 从 0.0 变化到 1.0， 并且 $P_Miss$ + $P_Hit$ = 1.0。

#### 例子

- 假设有一个机器有小型地址空间：4KB，每页 256 字节。
- 因此，虚拟地址由两部分组成：一个 4 位 VPN（最高有效位）和一个 8 位偏移量（最低有效位）。
- 因此，本例中的一个进程可以访问总共 $2^4 =16$ 个虚拟页。
- 在这个例子中，该进程将产生以下内存引用（即虚拟地址）0x000，0x100，0x200，0x300，0x400，0x500，0x600，0x700，0x800，0x900。
- 这些虚拟地址指向地址空间中前 10 页的每一页的第一个字节（页号是每个虚拟地址的第一个十六进制数字）。
- 让我们进一步假设，除了虚拟页 3 之外，所有页都已经在内存中。
- 因此，我们的内存引用序列将遇到以下行为：命中，命中，命中，未命中，命中，命中，命中，命中，命中。 
- 我们可以计算命中率（hit rate，在内存中找到引用的百分比）：90%（P Hit = 0.9），因为 10 个引用中有 9 个在内存中。
- 未命中率（miss rate）显然是 10%（P Miss= 0.1）。
- 假设访问内存（TM）的 成本约为 100ns，并且访问磁盘（TD）的成本大约为 10ms。
- 则我们有以下 AMAT：0.9×100ns + 0.1×10ms，即90ns + 1ms或1.0009ms，或约1ms。
- 如果我们的命中率是99.9%（P Miss= 0.001），结果是完全不同的：AMAT 是 10.1μs，大约快 100 倍。
- 当命中率接近 100%时，AMAT 接近 100ns。

*在现代系统中，磁盘访问的成本非常高，即使很小概率的未命中也会拉低正在运行的程序的总体 AMAT。显然，我们必须尽可能地避免缓存未命中，避免程序以磁盘的速度运行。*

### 最优替换策略


